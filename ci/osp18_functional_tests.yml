---
- name: Telemetry tests on osp18 with autoscaling enabled
  hosts:  "{{ cifmw_target_hook_host | default('localhost')  }}"
  gather_facts: true
  environment:
    KUBECONFIG: "{{ cifmw_openshift_kubeconfig }}"
    PATH: "{{ cifmw_path }}"
  tasks:
    - name: Gather list of vars files
      ansible.builtin.set_fact:
        vars_files: "{{ lookup('fileglob', vars_path + '/*.yml', wantlist=True) }}"

    - name: Include multiple variable files
      include_vars: "{{ item }}"
      with_items: "{{ vars_files }}"

    - name: "Run Telemetry Autoscaling tests"
      ansible.builtin.import_role:
        name: telemetry_autoscaling
      tags: autoscaling

    - name: "Run Telemetry Logging tests"
      ansible.builtin.import_role:
        name: telemetry_logging
      tags: logging
