---
- name: Prepare the Host
  hosts: controller
  gather_facts: no
  become: true
  tasks:
    - name: Add line after [defaults]
      ansible.builtin.blockinfile:
        path: /etc/ansible/ansible.cfg
        marker: "# {mark} ANSIBLE MANAGED BLOCK"
        block: |
          callback_whitelist = custom_logger
        insertafter: "^\\[defaults\\]"
      delegate_to: localhost

    - name: "Log into the cluster"
      ansible.builtin.import_role:
        name: rhol_crc
        tasks_from: add_crc_creds.yml
