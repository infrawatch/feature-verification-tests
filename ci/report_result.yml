---
- name: Move callback_plugin result to log dir
  ansible.builtin.shell:
    cmd: |
      cp  ~/test_run_result.out  {{ test_dir }}/test_run_result.log
     # cp  ~/summary_results.log {{ autoscaling_logs_dir }}/summary_results.log

- name: Grep the number of failed tasks
  ansible.builtin.shell:
    cmd: |
      grep -c "failed" ~/test_run_result.out
  register: tasks_failed
  ignore_errors: yes

- name: Determine success or failure based on the number of failed tasks
  ansible.builtin.fail:
    msg: "The log file contains failed task."
  when: tasks_failed.rc == 0