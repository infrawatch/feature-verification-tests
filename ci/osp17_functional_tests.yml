---
- name: "Run functional test playbooks"
  hosts:  controller
  vars:
    shell_header: set -euxo pipefail
    oc_header: eval $(crc oc-env)
  tasks: 
    - name: Setup the env before running the autoscaling functional test
    block:
      - community.general.make:
          chdir: '{{ ansible_env.HOME }}/{{ zuul.projects["github.com/openstack-k8s-operators/install_yamls"].src_dir }}/devsetup'
          target: standalone_deploy 
        tags:
          - setup

    - name: Test service API endpoint(metric) for autoscaling
      ansible.builtin.shell: |
        {{ shell_header }}
        {{ oc_header }}
        alias openstack="oc exec -t openstackclient -- openstack"
        ${BASH_ALIASES[openstack]} endpoint list --service metric
      register: result

    - name: Print the result
      ansible.builtin.debug:
        var: result