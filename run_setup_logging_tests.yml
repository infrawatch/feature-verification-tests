---
- name: Setup Logging Tests
  hosts: localhost
  connection: local
  gather_facts: false
  ignore_errors: true
  become: true
  vars:
    feat_test_path: "{{ playbook_dir }}/roles/telemetry_logging/tasks"

  environment:
    KUBECONFIG: "{{ cifmw_openshift_kubeconfig }}"
    PATH: "{{ cifmw_path }}"

  tasks:
    - name: "Log into OCP"
      ansible.builtin.shell:
        cmd: |
          oc login -u kubeadmin -p "12345678" https://api.crc.testing:6443
      failed_when: false
      changed_when: false

    - name: "Create id rsa file for ctlplane access"
      ansible.builtin.shell:
        cmd: | 
          oc extract -n openstack secrets/dataplane-ansible-ssh-private-key-secret --to=- | grep -v "ssh\-rsa" > id_rsa.ctlplane
      register: rsa_results 
      failed_when: rsa_results.rc != 0
      changed_when: false

