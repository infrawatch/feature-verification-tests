---
- job:
    name: osp18-with-autoscaling
    parent: podified-multinode-edpm-deployment-crc
    dependencies: ["openstack-k8s-operators-content-provider"]
    description: |
      Deploy OpenStack with Autoscaling features enabled
    vars:
      cifmw_extras:
        - "@{{ ansible_user_dir }}/{{ zuul.projects['github.com/openstack-k8s-operators/ci-framework'].src_dir  }}/scenarios/centos-9/multinode-ci.yml"
        - "@{{ ansible_user_dir }}/{{ zuul.projects['github.com/openstack-k8s-operators/telemetry-operator'].src_dir }}/ci/vars-autoscaling.yml"

- project-template:
    name: osp18-functional-test-jobs
    openstack-experimental:
      jobs:
        - osp18-with-autoscaling:
            dependencies: []
            # Required because RDO and openstack repos use master as their default branch and also try to check out master for all the projects included in a job.
            required-projects:
              - name: openstack-k8s-operators/ci-framework
                override-checkout: main
              - name: openstack-k8s-operators/dataplane-operator
                override-checkout: main
              - name: openstack-k8s-operators/install_yamls
                override-checkout: main
              - name: openstack-k8s-operators/infra-operator
                override-checkout: main
              - name: openstack-k8s-operators/openstack-baremetal-operator
                override-checkout: main
              - name: openstack-k8s-operators/openstack-must-gather
                override-checkout: main
              - name: openstack-k8s-operators/openstack-operator
                override-checkout: main
              - name: openstack-k8s-operators/repo-setup
                override-checkout: main
              - name: openstack-k8s-operators/edpm-ansible
                override-checkout: main

- job:
    name: functional-tests-on-osp18
    parent: telemetry-operator-multinode-autoscaling
    description: |
      Run the  functional tests on osp18 using parent job in telemetry-operator repo.
    roles:  
      - zuul: github.com/openstack-k8s-operators/ci-framework
    required-projects:
      - name: github.com/infrawatch/service-telemetry-operator
      - name: openstack-k8s-operators/ci-framework
        override-checkout: main
      - name: github.com/openstack-k8s-operators/dataplane-operator
        override-checkout: main
      - name: github.com/openstack-k8s-operators/infra-operator
        override-checkout: main
      - name: github.com/openstack-k8s-operators/openstack-operator
        override-checkout: main
      - name: github.com/openstack-k8s-operators/openstack-must-gather
        override-checkout: main
      - name: github.com/openstack-k8s-operators/telemetry-operator
        override-checkout: main
    run:
      - ci/run_playbooks.yml

- project:
    name: infrawatch/feature-verification-tests
    github-check:
      jobs:
        - osp18-with-autoscaling
       # - functional-tests-on-osp18
