---

- name: Get journals
  ansible.builtin.shell:
    cmd:
      tstamp=$(date -d '30 minute ago' "+%Y-%m-%d %H:%M:%S") 
      journalctl -t "{{ item }}" --no-pager -S "${tstamp}" | wc -l
  register: journal_wc
  changed_when: false
  failed_when: false

- name: Set status "{{ item }}"
  ansible.builtin.set_fact:
    t_status: FAILED      

- name: Set file status to PASSED - "{{ item }}"
  ansible.builtin.set_fact:
    t_status: PASSED
  when: 
    - journal_wc.stdout | int > 1
  failed_when: false

- name: Push result to "{{ journal_exists_outfile }}"
  ansible.builtin.lineinfile:
    path: "{{ journal_exists_outfile }}"
    line: "{{ item }},{{ journal_wc.stdout }},{{ t_status }}"
    state: present
    create: yes
  changed_when: t_status == "FAILED"
