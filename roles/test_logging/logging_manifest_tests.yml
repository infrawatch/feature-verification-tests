---

- name: Get number of packages
  ansible.builtin.shell:
    cmd: |
      echo "{{ item }}" | awk '{print $2;}'
  register: num_expected
  changed_when: false

- name: Get package name
  ansible.builtin.shell:
    cmd: |
      echo "{{ item }}" | awk '{print $1;}'
  register: pack_name
  changed_when: false

- name: Get packagemanifest
  ansible.builtin.shell:
    cmd: |
      oc get packagemanifests | grep "{{ pack_name.stdout }}" | wc -l
  register: num_found 
  changed_when: false

- name: Set Fail State
  ansible.builtin.set_fact:
     exists: FAILED

- name: Set Pass State
  ansible.builtin.set_fact:
    exists: PASSED
  when: num_expected.stdout == num_found.stdout

- name: Push result to "{{ manifest_out_file }}"
  ansible.builtin.shell:
    'echo "{{ pack_name.stdout }},{{ num_found.stdout }},{{ exists }}" >> "{{ manifest_out_file }}"'
  changed_when: false


