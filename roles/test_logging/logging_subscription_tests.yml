---

- name: Verify subscription
  ansible.builtin.shell:
    cmd: |
      oc get subscriptions -n "{{ nspace }}" "{{ item }}" 
  register: output
  changed_when: false
  ignore_errors: yes

- name: Test subscrition does not exist - "{{ item }}"
  ansible.builtin.set_fact:
     exists: FAILED

- name: Test subscription  exists - "{{ item }}"
  ansible.builtin.set_fact:
    exists: PASSED
  when: output.rc == 0

- name: Push result to "{{ subscript_out_file }}"
  ansible.builtin.shell:
    'echo "{{ nspace }},{{ item }},{{ exists }}" >> "{{ subscript_out_file }}"'
  changed_when: exists == "FAILED"
