---

- name: Verify Service Running - "{{ item }}"
  ansible.builtin.shell:
    cmd: |
      oc get service -n "{{ nspace }}" "{{ item }}"
  register: output 
  changed_when: false
  ignore_errors: yes

- name: "Set to failed service - {{ item }}"
  ansible.builtin.set_fact:
     exists: FAILED

- name: "If service exists - {{ item }}"
  ansible.builtin.set_fact:
    exists: PASSED 
  when: output.rc == 0

- name: "Push service check results to {{ services_out_file }}"
  ansible.builtin.lineinfile:
     path: "{{ services_out_file }}"
     line: "Service,{{ item }},{{ exists }}"
     create: yes
     mode: '0644'
  changed_when: exists == "FAILED"
