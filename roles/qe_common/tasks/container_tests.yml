---

- name: Get container status
  ansible.builtin.shell:
    cmd: |
      podman ps -a --format "{{ '{{.Names}} {{.Status}}' }}" | grep "{{ item }}" | awk '{print $2;}'
  register: container_status
  changed_when: false
  failed_when: false

- name: Set status to FAILED
  ansible.builtin.set_fact:
    t_status: FAILED    

- name: Test Container is Up - "{{ item }}"
  ansible.builtin.set_fact:
    t_status: PASSED
  when: container_status.stdout == "Up"
  failed_when: false

- name: Push result to "{{ container_out_file }}"
  ansible.builtin.shell:
    'echo "{{ inventory_hostname }},{{ item }},{{ t_status }}" >> "{{ container_out_file }}"'
  changed_when: t_status  == "FAILED"
